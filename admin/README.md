# 管理画面 - 使用方法

アクリルスタンド工房の管理画面の使い方と機能説明

## 📋 目次

1. [アクセス方法](#アクセス方法)
2. [ログイン](#ログイン)
3. [ダッシュボード](#ダッシュボード)
4. [注文一覧](#注文一覧)
5. [注文詳細](#注文詳細)
6. [ステータス管理](#ステータス管理)
7. [API仕様](#api仕様)

---

## アクセス方法

管理画面にアクセスするには、以下のURLにアクセスしてください：

```
https://your-domain.com/admin/
```

---

## ログイン

### デフォルトパスワード
```
admin123
```

⚠️ **重要**: 本番環境では必ずパスワードを変更してください！

パスワードを変更するには、`admin/index.php` の以下の行を編集してください：

```php
define('ADMIN_PASSWORD', 'admin123');  // ここを変更
```

---

## ダッシュボード

ログイン後、以下の情報が表示されます：

### 📊 統計情報
- **総注文数**: データベース内の全注文数
- **現在のページ**: ページネーション情報

### 🔍 フィルター機能
- **検索**: 注文番号、顧客名、メールアドレスで検索
- **ステータスフィルター**: 注文状態で絞り込み
  - すべて
  - 新規
  - 処理中
  - 完了
  - キャンセル

---

## 注文一覧

### 表示項目

| 項目 | 説明 |
|------|------|
| 注文番号 | AS-YYYYMMDD-XXXX形式の一意な注文番号 |
| 日時 | 注文が作成された日時 |
| 顧客名 | 注文者の名前 |
| 商品画像 | アップロードされた画像のサムネイル |
| サイズ | カード/はがき/A5/A4 |
| 台座 | 選択された台座デザイン |
| 金額 | 合計金額（税込） |
| ステータス | 新規/処理中/完了/キャンセル |
| 操作 | 詳細ボタン |

### 操作方法

1. **行をクリック**: 注文詳細を表示
2. **詳細ボタン**: 注文詳細モーダルを開く
3. **検索**: リアルタイムで絞り込み
4. **ステータスフィルター**: サーバーサイドで絞り込み

---

## 注文詳細

注文行または詳細ボタンをクリックすると、モーダルウィンドウで詳細情報が表示されます。

### 📋 注文情報
- 注文番号
- 注文日時
- 現在のステータス

### 👤 お客様情報
- お名前
- メールアドレス
- 電話番号
- 配送先住所

### 🎨 商品情報
- 商品画像（大きなプレビュー）
- サイズ
- 台座タイプ
- 数量

### 💰 金額
- 商品単価
- 送料
- 合計金額

### ステータス変更ボタン
- 🆕 新規にする
- 🔄 処理中にする
- ✅ 完了にする
- ❌ キャンセルする

---

## ステータス管理

### ステータスの種類

| ステータス | 説明 | 色 |
|-----------|------|-----|
| 新規 (pending) | 新しく受け付けた注文 | 黄色 |
| 処理中 (processing) | 製作中または発送準備中 | 青色 |
| 完了 (completed) | 発送済みまたは完了 | 緑色 |
| キャンセル (cancelled) | キャンセルされた注文 | 赤色 |

### ステータス変更の流れ

```
新規 → 処理中 → 完了
  ↓
キャンセル（任意のステータスから）
```

### 変更方法

1. 注文詳細モーダルを開く
2. 下部のステータスボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. 更新完了メッセージを確認
5. モーダルが閉じて一覧が更新される

---

## API仕様

管理画面が使用するAPIエンドポイント：

### 1. 注文一覧取得

```
GET /api/orders.php
```

**クエリパラメータ:**
- `status` (オプション): pending, processing, completed, cancelled
- `limit` (オプション): 取得件数（デフォルト: 50）
- `offset` (オプション): オフセット（デフォルト: 0）

**レスポンス例:**
```json
{
  "success": true,
  "orders": [
    {
      "id": 1,
      "order_number": "AS-20251221-0001",
      "customer_name": "山田太郎",
      "customer_email": "yamada@example.com",
      "image_path": "uploads/image.jpg",
      "size": "card",
      "base_type": "default",
      "total_price": 1000,
      "status": "pending",
      "created_at": "2025-12-21 10:30:00"
    }
  ],
  "total": 1,
  "limit": 50,
  "offset": 0
}
```

### 2. 注文詳細取得

```
GET /api/order-detail.php?id=1
```

**クエリパラメータ:**
- `id` (必須): 注文ID

**レスポンス例:**
```json
{
  "success": true,
  "order": {
    "id": 1,
    "order_number": "AS-20251221-0001",
    "customer_name": "山田太郎",
    "customer_email": "yamada@example.com",
    "customer_phone": "090-1234-5678",
    "customer_address": "東京都...",
    "image_path": "uploads/image.jpg",
    "size": "card",
    "base_type": "default",
    "quantity": 1,
    "unit_price": 1000,
    "shipping_fee": 0,
    "total_price": 1000,
    "status": "pending",
    "created_at": "2025-12-21 10:30:00"
  }
}
```

### 3. ステータス更新

```
POST /api/update-status.php
```

**リクエストボディ:**
```json
{
  "order_id": 1,
  "status": "processing"
}
```

**レスポンス例:**
```json
{
  "success": true,
  "message": "ステータスを更新しました"
}
```

---

## 🎨 デザイン仕様

### カラースキーム
- **プライマリー**: グラデーション (#667eea → #764ba2)
- **背景**: グラデーション背景 + ホワイトカード
- **ステータス**:
  - 新規: イエロー系
  - 処理中: ブルー系
  - 完了: グリーン系
  - キャンセル: レッド系

### レスポンシブ対応
- デスクトップ: 1280px以上
- タブレット: 768px - 1279px
- モバイル: 768px未満

---

## 🔧 カスタマイズ

### パスワード変更

`admin/index.php` の22行目を編集：

```php
define('ADMIN_PASSWORD', 'your-secure-password');
```

より安全な方法：
1. 環境変数を使用
2. `password_hash()` と `password_verify()` を使用
3. データベースでユーザー管理

### スタイルのカスタマイズ

`admin/css/admin.css` を編集してデザインを変更できます。

### 機能の追加

`admin/js/admin.js` を編集して機能を追加できます。

---

## 🔐 セキュリティ

### 実装されている対策
- ✅ セッションベースの認証
- ✅ パスワード認証
- ✅ SQLインジェクション対策（PDO）
- ✅ XSS対策（HTMLエスケープ）
- ✅ CSRF対策（推奨）

### セキュリティチェックリスト
- [ ] デフォルトパスワードを変更
- [ ] HTTPS を有効化
- [ ] .htaccess で admin/ を保護
- [ ] セッションタイムアウトを設定
- [ ] ログアウト機能を使用

---

## 📱 使用例

### 新しい注文を確認する

1. 管理画面にログイン
2. 「新規」のステータスバッジがついている注文を確認
3. 注文をクリックして詳細を確認
4. 内容を確認したら「処理中にする」をクリック

### 注文を完了する

1. 処理中の注文を検索
2. 注文詳細を開く
3. 「完了にする」ボタンをクリック
4. 確認してステータスを更新

### 注文をキャンセルする

1. 該当する注文を検索
2. 注文詳細を開く
3. 「キャンセルする」ボタンをクリック
4. 確認してステータスを更新

---

## 🐛 トラブルシューティング

### ログインできない
- パスワードが正しいか確認
- セッションが有効か確認
- `admin/index.php` のパスワード設定を確認

### 注文が表示されない
- データベース接続を確認
- `api/config.php` の設定を確認
- ブラウザのコンソールでエラーを確認

### 画像が表示されない
- 画像パスが正しいか確認
- `uploads/` ディレクトリのパーミッションを確認
- ブラウザのコンソールでエラーを確認

### ステータス更新ができない
- データベース接続を確認
- ブラウザのコンソールでエラーを確認
- `api/update-status.php` のエラーログを確認

---

## 📞 サポート

問題が発生した場合は、GitHubのIssuesで報告してください。

---

© 2024 アクリルスタンド工房. All rights reserved.

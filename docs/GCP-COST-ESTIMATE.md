# GCP 成本估算 - アクリルスタンド工房
# GCP Cost Estimation - Acrylic Stand Workshop

本文档提供详细的GCP运营成本估算，包括不同流量场景下的预估费用。

---

## 📊 成本概览

### 低流量场景（个人测试/小型运营）
- **月访问量**: ~1,000 次
- **月订单数**: ~10 个
- **预估成本**: **¥0 - ¥50/月** (免费额度内)

### 中等流量场景（小型电商）
- **月访问量**: ~10,000 次
- **月订单数**: ~100 个
- **预估成本**: **¥300 - ¥800/月**

### 高流量场景（中型电商）
- **月访问量**: ~100,000 次
- **月订单数**: ~1,000 个
- **预估成本**: **¥2,500 - ¥5,000/月**

---

## 💰 详细服务成本分解

### 1. Cloud Run（核心服务）

**免费额度（每月）**:
- 200万次请求
- 36万 GB-秒的内存
- 18万 vCPU-秒
- 1 GB 网络出站流量

**超出免费额度后的价格**:
```
请求费用:
- ¥0.0004/请求 ($0.40/百万请求)

计算费用:
- CPU: ¥0.00024/vCPU-秒
- 内存: ¥0.0000025/GB-秒

网络出站费用（亚太地区）:
- 0-1 GB: 免费
- 1-10 TB: ¥0.12/GB
- 10+ TB: ¥0.08/GB
```

#### 实际使用场景估算

**低流量（1,000访问/月）**:
```
请求数: ~5,000 次（每次访问平均5个请求）
CPU使用: ~50 vCPU-秒
内存使用: 512MB × 10秒/请求 × 5,000请求 = 25,600 GB-秒
网络出站: ~5 GB

成本: ¥0（完全在免费额度内）
```

**中等流量（10,000访问/月）**:
```
请求数: ~50,000 次
CPU使用: ~500 vCPU-秒
内存使用: ~256,000 GB-秒
网络出站: ~50 GB

计算:
- 请求费: 50,000 × ¥0.0004 = ¥20
- CPU费: (500 - 180,000免费) = 在免费额度内
- 内存费: (256,000 - 360,000免费) = 在免费额度内
- 网络费: (50GB - 1GB免费) × ¥0.12 = ¥5.88

月度成本: ~¥26
```

**高流量（100,000访问/月）**:
```
请求数: ~500,000 次
CPU使用: ~5,000 vCPU-秒
内存使用: ~2,560,000 GB-秒
网络出站: ~500 GB

计算:
- 请求费: 500,000 × ¥0.0004 = ¥200
- CPU费: (5,000 - 180,000免费) = 在免费额度内
- 内存费: (2,560,000 - 360,000) × ¥0.0000025 = ¥5.5
- 网络费: (500GB - 1GB) × ¥0.12 = ¥59.88

月度成本: ~¥265
```

---

### 2. Container Registry (存储Docker镜像)

**价格**:
```
存储费用:
- ¥0.026/GB/月

网络费用:
- 同区域: 免费
- 跨区域: ¥0.12/GB
```

**实际成本**:
```
Docker镜像大小: ~500 MB = 0.5 GB
月度成本: 0.5 × ¥0.026 = ¥0.013 (可忽略不计)
```

---

### 3. Cloud Storage (图片存储)

**免费额度**:
- 5 GB 标准存储（美国地区）

**亚太地区价格**:
```
存储费用:
- 标准存储: ¥0.023/GB/月
- Nearline: ¥0.016/GB/月
- Coldline: ¥0.006/GB/月

操作费用:
- 写入操作: ¥0.05/万次
- 读取操作: ¥0.004/万次

网络出站费用:
- 0-1 GB: 免费
- 1-10 TB: ¥0.12/GB
```

#### 实际使用场景

**低流量（10订单/月）**:
```
假设:
- 每个订单上传1张图片
- 平均图片大小: 5 MB
- 总存储: 10 × 5 MB = 50 MB = 0.05 GB

成本:
- 存储费: 0.05 × ¥0.023 = ¥0.00115
- 写入操作: 10次 ≈ ¥0
- 读取操作: 50次（展示） ≈ ¥0
- 网络出站: 0.25 GB = 在免费额度内

月度成本: ~¥0（可忽略）
```

**中等流量（100订单/月）**:
```
假设:
- 总存储: 100 × 5 MB × 保留3个月 = 1.5 GB
- 写入: 100次
- 读取: 1,000次
- 网络出站: 5 GB

成本:
- 存储费: 1.5 × ¥0.023 = ¥0.0345
- 操作费: ~¥0
- 网络费: (5-1) × ¥0.12 = ¥0.48

月度成本: ~¥0.5
```

**高流量（1,000订单/月）**:
```
假设:
- 总存储: 1,000 × 5 MB × 保留3个月 = 15 GB
- 写入: 1,000次
- 读取: 10,000次
- 网络出站: 50 GB

成本:
- 存储费: 15 × ¥0.023 = ¥0.345
- 操作费: ~¥0.01
- 网络费: (50-1) × ¥0.12 = ¥5.88

月度成本: ~¥6.2
```

---

### 4. Cloud SQL (数据库 - 可选)

如果使用Cloud SQL存储订单数据：

**最小实例（db-f1-micro）**:
```
配置:
- 1 共享 vCPU
- 0.6 GB 内存
- 10 GB 存储

价格:
- 实例费用: ¥90/月（按需）或 ¥60/月（承诺使用折扣）
- 存储费用: 10GB × ¥0.17/GB = ¥1.7/月
- 备份费用: 10GB × ¥0.08/GB = ¥0.8/月

月度成本: ~¥62.5 - ¥92.5
```

**推荐方案**:
对于小型应用，可以先用文件存储订单数据，避免数据库成本。如需数据库，可以使用外部托管服务（如PlanetScale免费层）。

---

### 5. Cloud Build (CI/CD构建)

**免费额度**:
- 每天120分钟构建时间

**超出后价格**:
```
- ¥0.003/构建分钟
```

**实际成本**:
```
假设每天部署1次，每次构建5分钟:
- 月构建时间: 5分钟 × 30天 = 150分钟
- 超出免费额度: 150 - (120×30) = 负数（在免费额度内）

月度成本: ¥0
```

---

### 6. Secret Manager (密钥管理 - 可选)

**价格**:
```
- 每个活跃密钥: ¥0.06/月
- 访问操作: ¥0.03/万次
```

**实际成本**:
```
假设5个密钥（数据库密码、API密钥等）:
- 存储费: 5 × ¥0.06 = ¥0.3
- 访问费: ~¥0（访问次数很少）

月度成本: ~¥0.3
```

---

## 📈 总成本汇总表

| 流量场景 | Cloud Run | Cloud Storage | Cloud SQL | Secret Manager | 总计 |
|---------|-----------|---------------|-----------|----------------|------|
| **低流量**<br>1,000访问/月<br>10订单/月 | ¥0 | ¥0 | ¥0* | ¥0 | **¥0** |
| **中等流量**<br>10,000访问/月<br>100订单/月 | ¥26 | ¥0.5 | ¥0* | ¥0.3 | **¥27** |
| **高流量**<br>100,000访问/月<br>1,000订单/月 | ¥265 | ¥6 | ¥0* | ¥0.3 | **¥271** |

*不使用Cloud SQL，使用文件存储

### 如果使用Cloud SQL

| 流量场景 | 总成本（含数据库） |
|---------|-------------------|
| 低流量 | **¥63/月** |
| 中等流量 | **¥90/月** |
| 高流量 | **¥334/月** |

---

## 💡 成本优化建议

### 1. 利用免费额度

**Cloud Run免费额度非常慷慨**：
- 对于月访问量<50,000的网站，基本完全免费
- 设置 `--min-instances=0` 在无流量时自动缩容到0

### 2. 优化图片存储

```bash
# 方案A: 使用Cloud Storage（推荐）
# - 设置生命周期策略，30天后删除临时文件
gsutil lifecycle set lifecycle.json gs://your-bucket

# lifecycle.json 示例
{
  "lifecycle": {
    "rule": [
      {
        "action": {"type": "Delete"},
        "condition": {"age": 30}
      }
    ]
  }
}

# 方案B: 本地存储（最便宜）
# - 图片存储在容器内（不推荐，容器重启会丢失）
# - 适合测试环境
```

### 3. 避免不必要的数据库

**对于小型应用**：
- 使用JSON文件存储订单（存在Cloud Storage）
- 使用第三方服务（如Google Sheets API）
- 只在订单量>1000/月时考虑数据库

### 4. CDN和缓存

```bash
# 启用Cloud CDN（可选）
# - 减少网络出站费用
# - 加速全球访问
gcloud compute backend-services update akuriru-stand \
    --enable-cdn
```

**预期节省**: 30-50%的网络费用

### 5. 设置预算警报

```bash
# 在GCP控制台设置预算
# 推荐设置: ¥100/月警报（低流量）
#           ¥500/月警报（中等流量）
```

防止意外超支！

---

## 🎯 推荐配置（按需求）

### 配置1: 测试/演示环境 (¥0/月)
```yaml
服务:
  - Cloud Run (免费额度内)
  - Container Registry (可忽略)
  - 本地图片存储

适合:
  - 个人项目
  - 原型测试
  - 低流量网站(<1,000访问/月)
```

### 配置2: 小型电商 (¥30-50/月)
```yaml
服务:
  - Cloud Run (轻度使用)
  - Cloud Storage (图片存储)
  - JSON文件存储订单
  - Secret Manager

适合:
  - 月订单<100
  - 月访问<10,000
  - 个人/小型商家
```

### 配置3: 成长型电商 (¥300-500/月)
```yaml
服务:
  - Cloud Run (中度使用)
  - Cloud Storage (图片+备份)
  - Cloud SQL (小型实例)
  - Secret Manager
  - Cloud CDN (可选)

适合:
  - 月订单100-1,000
  - 月访问10,000-100,000
  - 专业商家
```

---

## 🔍 实时成本监控

### 查看当前费用

```bash
# 1. 使用 gcloud 命令
gcloud billing accounts list

# 2. 查看项目计费信息
gcloud beta billing projects describe PROJECT_ID

# 3. 在网页控制台查看
# https://console.cloud.google.com/billing
```

### 导出计费数据到BigQuery

```bash
# 启用详细计费分析（免费）
gcloud beta billing accounts set-billing-export \
    --billing-account=BILLING_ACCOUNT_ID \
    --dataset-id=billing_dataset \
    --project=PROJECT_ID
```

---

## 📊 与其他平台对比

| 平台 | 月成本（中等流量） | 优点 | 缺点 |
|------|-------------------|------|------|
| **GCP Cloud Run** | ¥30-50 | 按使用付费<br>扩展性好<br>免费额度大 | 冷启动<br>需要容器知识 |
| **AWS Lambda + S3** | ¥40-70 | 成熟生态<br>文档丰富 | 复杂度高<br>冷启动 |
| **Heroku** | ¥700/月 | 简单易用<br>零配置 | 贵<br>性能一般 |
| **VPS (Vultr/DO)** | ¥400/月 | 固定价格<br>完全控制 | 需要运维<br>不能自动扩展 |
| **共享主机** | ¥50-100/月 | 便宜 | 性能差<br>不适合PHP 8+ |

**结论**: 对于你的应用，GCP Cloud Run是性价比最高的选择。

---

## 💰 实际案例分析

### 案例1: 个人项目（月访问500次）
```
实际费用: ¥0
使用服务:
  - Cloud Run (免费额度)
  - 本地图片存储

结论: 完全在免费额度内
```

### 案例2: 小型商家（月访问5,000，订单50）
```
实际费用: ¥15
使用服务:
  - Cloud Run: ¥10
  - Cloud Storage: ¥5
  - 不使用数据库（JSON存储）

结论: 非常便宜，适合起步阶段
```

### 案例3: 成长中商家（月访问50,000，订单500）
```
实际费用: ¥280
使用服务:
  - Cloud Run: ¥200
  - Cloud Storage: ¥20
  - Cloud SQL: ¥60

结论: 随着业务增长，成本依然可控
```

---

## 🎓 成本节省小贴士

### 1. 使用承诺使用折扣 (CUD)
如果月成本稳定在>¥500，可以购买1年或3年承诺使用折扣：
- 1年: 节省25%
- 3年: 节省52%

### 2. 合理设置资源限制
```yaml
# 在 cloudbuild.yaml 中
resources:
  memory_gb: 0.5  # 不要设置过大
  cpu: 1          # 大部分应用1核够用
```

### 3. 定期清理资源
```bash
# 删除旧的Docker镜像
gcloud container images list-tags gcr.io/PROJECT_ID/akuriru-stand \
    --filter="timestamp.datetime < '2024-01-01'" \
    --format="get(digest)" | \
    xargs -I {} gcloud container images delete "gcr.io/PROJECT_ID/akuriru-stand@{}" --quiet

# 删除旧的Cloud Build日志
gcloud builds list --limit=100 --filter="createTime<2024-01-01" --format="value(id)" | \
    xargs -I {} gcloud builds delete {}
```

### 4. 使用外部免费服务

**数据库**:
- PlanetScale (免费层: 5GB存储)
- Supabase (免费层: 500MB + 实时功能)

**图片存储**:
- Cloudinary (免费层: 25GB/月)
- imgix (免费试用)

**邮件服务**:
- SendGrid (免费层: 100邮件/天)
- Mailgun (免费层: 5,000邮件/月)

---

## 📞 总结与建议

### 💯 推荐起步配置（月成本 ¥0-30）

```yaml
配置:
  Cloud Run:
    - min-instances: 0
    - max-instances: 10
    - memory: 512Mi
    - cpu: 1

  存储:
    - 订单: JSON文件 (Cloud Storage)
    - 图片: Cloud Storage (设置30天自动删除)

  数据库: 不使用（或使用免费外部服务）

预期成本: ¥0-30/月（<10,000访问时）
```

### 🚀 扩展建议

当月访问量超过10,000时：
1. 考虑添加Cloud CDN (节省带宽成本)
2. 考虑使用Cloud SQL (提升性能)
3. 设置预算警报 (¥500/月)
4. 开启详细监控和日志

### 📈 成本增长预测

| 月访问量 | 预估月成本 |
|---------|-----------|
| 1,000 | ¥0 |
| 10,000 | ¥30 |
| 50,000 | ¥150 |
| 100,000 | ¥300 |
| 500,000 | ¥1,500 |
| 1,000,000 | ¥3,000 |

**结论**: 你的网站在GCP上运行非常经济实惠。对于大部分小型到中型电商网站，月成本会在 **¥0-300** 之间。

---

**最后更新**: 2025-12-30
**汇率**: 1 USD ≈ 7.2 CNY (参考)
**地区**: 亚太地区 (asia-northeast1 - 东京)

需要更详细的成本分析或有其他问题，请随时询问！
